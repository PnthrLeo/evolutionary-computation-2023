# Проектирование эволюционного алгоритма для задачи расстановки ферзей

## Цель работы
Целью данной работы является освоение всего цикла разработки эволюционных алгоритмов, начиная с анализа проблемы и проективрования, заканчивая настройкой параметров и анализом эффективности.

## Анализ задачи расстановки ферзей
Был произведён анализ задачи расстановки ферзей. В ходе анализа были выявлены следующие особенности:
1. Наиболее очевидный способ представления решения – это двухмерный массив, в котором каждый элемент массива является булевым значением, указывающим на то, находится ли ферзь на данной клетке доски или нет. Однако, такое представление не является оптимальным, так как в нём не учитывается информация о том, что в каждом столбце доски может находиться только один ферзь. Таким образом, можно представить решение в виде одномерного массива, в котором каждый элемент массива является индексом строки, в которой находится ферзь в соответствующем столбце. Более того, можно также учесть факт что в каждой строке доски также может находиться только один ферзь и добавить условие на неповторение индексов строк в решении (т.е. тогда решение будет представлять собой перестановку из индексов строк). При помощи данных манипуляций можно существенно уменьшить размерность пространства решений, что в свою очередь позволит значительно ускорить работу алгоритма. Например для размерности проблемы $8 \times 8$ размерность пространства решений сократится c $4426165368=\frac{64!}{8!(64-8)!}$ до $16777216=8^8$, а затем ещё до $40320=8!$.
2. Т.к. построение *одного* решения для задачи расстановки ферзей любой размерности является тривиальной проблемой [1], то в рамках данной работы будет произведена попытка построить эволюционный алгоритм для поиска наибольшего колличества разнородных экземпляров решения задачи.

## Выполнениие работы
1. В качестве фреймворка для реализации эволюционного алгоритма был выбран [DEAP](https://deap.readthedocs.io/en/master/).
2. В качестве эволюционного алгоритма был выбран генетический алгоритм. Это связано с тем, что похожее представление решения в виде перестановки набора целых чисел использовалось в лабараторной работе №4 при решении задачи Коммивояджёра. В связи с этим появилась идея адоптировать ранее использованный алгоритм под текущую задачу.
3. В качестве фитнес-функции была выбрана функция, которая считает количество ферзей, которые не бьют друг друга. Таким образом, чем меньше ферзей бьют друг друга, тем лучше решение. Так как условия непересечения по вертикали и горизонтали уже учтены в представлении решения, то фитнесс-функции остаётся только проверять условие непересечения по диагонали. Для этого достаточно проверить, что для каждой пары ферзей $i$ и $j$ выполняется условие $|i-j| \neq |x_i-x_j|$, где $x_s$ – индекс строки, в которой находится ферзь в $s$-м столбце.
4. В связи с тем, что цель создаваемого алгоритма в поиске наибольшего колличества разнородных экземпляров решения задачи расстановки ферзей, то одна из важных задач – это поддержание разнообразия решения. Таким образом оператор мутации является основой предлагаемого алгоритма. В качестве реализации оператора мутации было принятно решение выбрать ```mutShuffleIndexes``` из модуля ```deap.tools```, который при значении ```indpb``` равном ```1.4 / NUMBER_OF_QUEENS```, где ```NUMBER_OF_QUEENS``` – размерность задачи, ведёт себя схожим образом с мутацией перестановкой, которая была использована в лабораторной работе №4... В качестве оператора скрещивания был выбран ```cxOrdered```. Однако, эмпирическим путём было выявлено, что при использовании оператора скрещивания спроектированный генетический алгоритм хуже подбирает разнообразные решения, чем при одиночном использовании оператора мутации. В связи с этим было принято решение не использовать оператор скрещивания... В качестве оператора селекции был выбран ```selTournament```, при помощи которого удаётся держать баланс между разнообразием решений и их качеством... В качестве основного алгоритма был выбран ```eaMuPlusLambda```.
5. Так как довольно сложно оценить, какое количество полученных верных решений является исчерпывающим, то было принято решение, что единственным критерием остановки алгоритма будет достижение заданного количества поколений.
6. Следующие характеристики используются для измерения эффективности алгоритма:
    1. количество найденных решений;
    2. кол-во посчитанных фитнесс-функций;
    3. кол-во посчитанных фитнесс-функций до нахождения первого решения;
    4. кол-во посчитанных фитнесс-функций до нахождения последнего решения.
7. Параметры генетического алгоритма были подобраны эмпирическим путём и настроены вручную.

## Результаты экспериментов по производительности алгоритма
Был произведён запуск алгоритма для различных разменостей проблемы. Для каждой размерности проблемы было произведено 10 запусков.

| Размерность проблемы | Размер популяции | Кол-во поколений | **Кол-во найденных решений** | Кол-во возможных решений | Кол-во посчитанных фитнесс-функций | Кол-во посчитанных фитнесс-функций до нахождения первого решения | Кол-во посчитанных фитнесс-функций до нахождения последнего решения |  
| :--- | --- | --- | --- | --- | --- | --- | --- |
| 6 | 10 | 100 | **4** | 4 | 7006 | 199.2 | 1905.6 |
| 7 | 10 | 700 | **40** | 40 | 49007 | 189.2 | 29873.2 |
| 8 | 10 | 2000 | **91.2** | 92 | 140008 | 248.2 | 116622.3 |
| 10 | 10 | 10000 | **406.4** | 724 | 700010 | 1223.3 | 696598.8 |
| 15 | 10 | 10000 | **105.2** | 2279184 | 700015 | 11109.8 | 696087.6 |
| 20 | 10 | 10000 | **23.2** | 39029188884 | 700020 | 41754.7 | 645237.3 |
| 100* | 10 | 100000 | **0** | (?) | ~7000000 | 0 | 0 |

\* - для размерности 100 был произведен 1 запуск, так как алгоритм работал слишком долго.


## Ответы на вопросы
**Q: Является ли задача оптимизационной или ограниченной?**

**A:** Задача не является оптимизационной, так как в ней необходимо найти *верные* решения, а не *наилучшие*. При этом задача является ограниченной, так как в ней имеются условия на передвижение ферзей.

**Q: Как растёт сложность задачи при увеличении размерности?**

**A:** При оптимальной постановке задачи сложность задачи растёт факториально от размерности задачи.

# Источники
1. Bernhardsson B. Explicit solutions to the n-queens problem for all n //ACM SIGART Bulletin. – 1991. – Т. 2. – №. 2. – С. 7.
